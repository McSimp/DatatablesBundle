{% block tommygnr_datatable %}

    {% block tommygnr_datatable_html %}

        <table cellpadding="0" cellspacing="0" border="0" class="{{ theme_tableClasses }}" id="{{ dt_tableId }}" width="100%">
            <thead>
            </thead>
                {% if dt_individualFiltering %}
                    <tfoot>
                        {% for column in dt_columns %}
                            <th>
                                {% if column.filterable %}
                                    <input type="text" class="{{ theme_formClasses }}" placeholder="{{ column.title }}" />
                                {% else %}
                                    <input type="hidden" />
                                {% endif %}
                            </th>
                        {% endfor %}
                        {% if dt_multiselect.enabled %}
                            <th></th>
                        {% endif %}
                    </tfoot>
                {% endif %}
            <tbody>
            </tbody>
        </table>

    {% endblock %}

    {% block tommygnr_datatable_js %}

        <script>

            $(document).ready(function () {

                var config = {
                    {% if dt_processing %}
                        "processing": true,
                    {% else %}
                        "processing": false,
                    {% endif %}
                    {% if dt_serverSide %}
                        "serverSide": true,
                        "ajax": "{{ dt_ajaxSource }}",
                    {% else %}
                        "data": {{ dt_data|raw }},
                    {% endif %}
                    {% if theme_pagination %}
                        "paginationType": "{{ theme_pagination }}",
                    {% endif %}
                    {% if theme_dom %}
                        "dom": "{{ theme_dom|raw }}",
                    {% endif %}
                    "lengthMenu": [[5, 10, 25, 50, 100, -1], [5, 10, 25, 50, 100, "{{ 'datatables.datatable.all'|trans({}, 'messages') }}"]],
                    "displayLength": {{ dt_displayLength }},
                    {% if 'jqueryui_datatable_theme' == theme_name %}
                        "jQueryUI": true,
                    {% endif %}
                    "language": {
                        "processing": "{{ 'datatables.datatable.processing'|trans({}, 'messages') }}",
                        "lengthMenu": "{{ 'datatables.datatable.lengthMenu'|trans({}, 'messages') }}",
                        "zeroRecords": "{{ 'datatables.datatable.zeroRecords'|trans({}, 'messages') }}",
                        "info": "{{ 'datatables.datatable.info'|trans({}, 'messages') }}",
                        "infoEmpty": "{{ 'datatables.datatable.infoEmpty'|trans({}, 'messages') }}",
                        "infoFiltered": "{{ 'datatables.datatable.infoFiltered'|trans({}, 'messages') }}",
                        "infoPostFix": "{{ 'datatables.datatable.infoPostFix'|trans({}, 'messages') }}",
                        "search": "{{ 'datatables.datatable.search'|trans({}, 'messages') }}",
                        "url": "",
                        "paginate": {
                            "first": "{{ 'datatables.datatable.first'|trans({}, 'messages') }}",
                            "previous": "{{ 'datatables.datatable.previous'|trans({}, 'messages') }}",
                            "next": "{{ 'datatables.datatable.next'|trans({}, 'messages') }}",
                            "last": "{{ 'datatables.datatable.last'|trans({}, 'messages') }}"
                        }
                    }
                };

                $.extend(config, {
                    "columns": [
                        {# multiselect column #}
                        {% if dt_multiselect.enabled %}
                            {% if 'first' == dt_multiselect.position %}
                                {% include "TommyGNRDatatablesBundle:Column:multiselect.html.twig" %}
                            {% endif %}
                        {% endif %}

                        {# columns #}
                        {% for column in dt_columns %}
                            {% include "TommyGNRDatatablesBundle:Column:" ~ column.getClassName ~ ".html.twig" %}
                        {% endfor %}

                        {# multiselect column #}
                        {% if dt_multiselect.enabled %}
                            {% if 'last' == dt_multiselect.position %}
                                {% include "TommyGNRDatatablesBundle:Column:multiselect.html.twig" %}
                            {% endif %}
                        {% endif %}
                    ]
                });

                var selector = "#{{ dt_tableId }}";
                var table = $(selector).DataTable(config);

                {% if dt_individualFiltering %}
                    $("tfoot input").keyup(function() {
                        table.column($("tfoot input").index(this)).search(this.value).draw();
                    });
                {% endif %}

                {% if dt_multiselect.enabled %}
                    var multiple_html = "\
                        <p>\
                            <select class='{{ theme_formClasses }}' name='bulk_action_routes[select]'>\
                                {% for key, value in dt_multiselect.actions %}\
                                    <option value='{{ path(value) }}'>{{ key }}</option>\
                                {% endfor %}\
                            </select>\
                            <button id='multiselect_submit' type='button' class='{{ theme_formSubmitButtonClasses }}'>Ok</button>\
                        </p>";

                    $(".pagination").append(multiple_html);

                    $(".multiselect_checkall").click(function(event) {
                        if(this.checked) {
                            $("input:checkbox.multiselect_checkbox").each(function() {
                                this.checked = true;
                            });
                        } else {
                            $("input:checkbox.multiselect_checkbox").each(function() {
                                this.checked = false;
                            });
                        }
                    });

                    $("#multiselect_submit").click(function() {
                        var length = $("input:checkbox:checked.multiselect_checkbox").length;

                        if (length > 0) {
                            if (!confirm( "{{ 'datatables.bulk.confirmMsg'|trans({}, 'messages') }}" )) {
                                return;
                            }

                            $.ajax({
                                url: $("select[name='bulk_action_routes[select]']").val(),
                                type: "POST",
                                cache: false,
                                data: {
                                    'data': $("input:checkbox:checked.multiselect_checkbox", table.fnGetNodes()).serializeArray()
                                },
                                success: function(msg) {
                                    table.fnDraw();
                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    console.log(XMLHttpRequest + ' ' + textStatus + ' ' +errorThrown);
                                }
                            })
                        } else {
                            alert("{{ 'datatables.bulk.selectError'|trans({}, 'messages') }}");
                        }
                    });
                {% endif %}

            });

        </script>

    {% endblock %}

    {% block tommygnr_datatable_render_functions %}

        <script>

            function render_boolean_icons(data, type, full, trueIcon, falseIcon, trueLabel, falseLabel) {
                if ('' == trueIcon && '' == trueLabel) {
                    trueLabel = 'true';
                }

                if ('' == falseIcon && '' == falseLabel) {
                    falseLabel = 'false';
                }

                if (data == true) {
                    return "<span class='" + trueIcon + "'></span> " + trueLabel;
                } else {
                    return "<span class='" + falseIcon + "'></span> " + falseLabel;
                }
            }

            function render_datetime(data, type, full, localizedFormat) {
                if (typeof data.timestamp != 'undefined') {
                    moment.lang("{{ app.request.locale }}");
                    return moment.unix(data.timestamp).format(localizedFormat);
                } else {
                    return null;
                }
            }

            function render_timeago(data, type, full) {
                if (typeof data.timestamp != 'undefined') {
                    moment.lang("{{ app.request.locale }}");
                    return moment.unix(data.timestamp).fromNow();
                } else {
                    return null;
                }
            }

        </script>

    {% endblock %}

{% endblock  %}
